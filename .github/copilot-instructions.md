# تعليمات Copilot لمشروع qanonweb

## نظرة عامة على المشروع
- **النوع:** تطبيق Flutter ويب وموبايل لإدارة العقود القانونية
- **الخدمات الأساسية:** مصادقة Firebase، قاعدة بيانات Firestore، تخزين Firebase Storage
- **تدفق البيانات الرئيسي:**
  - يقوم المستخدمون برفع ملفات العقود القانونية (PDF/Word) عبر واجهة المستخدم على الويب أو الموبايل
  - يتم تخزين الملفات في Firebase Storage، ويتم حفظ بياناتها الوصفية في Firestore
  - يتم عرض العقود، تصفيتها، وحذفها عبر واجهة المستخدم

## المجلدات والملفات الأساسية
- `lib/models/`: نماذج البيانات (`legal_contract.dart`, `contract_type.dart`)
- `lib/services/`: منطق الأعمال والتكامل مع Firebase (`legal_contract_service.dart`, `auth_service.dart`)
- `lib/screens/`: صفحات الواجهة (`home_screen.dart`, `login_screen.dart`)
- `firebase_options.dart`: إعدادات Firebase (تأكد من صحة قيمة `storageBucket`)
- `pubspec.yaml`: تبعيات المشروع

## الأنماط والمعايير المتبعة
- **طبقة الخدمات:** جميع عمليات Firebase تتم عبر كلاس الخدمات (مثل `LegalContractService`). يجب على الواجهة استدعاء هذه الخدمات فقط وليس واجهات Firebase مباشرة.
- **معالجة الأخطاء:** يتم التقاط الاستثناءات وإعادة رميها برسائل خطأ عربية لعرضها للمستخدم.
- **رفع الملفات:** يسمح فقط برفع ملفات PDF أو Word، والحد الأقصى للحجم 10 ميجابايت (انظر دالة `uploadContract` في `legal_contract_service.dart`).
- **تحديث التقدم:** يتم إرسال تقدم رفع الملف للواجهة عبر callback.
- **هيكل Firestore:** يتم حفظ العقود في مجموعة `legal_contracts`، وكل مستند يحتوي بيانات وصفية ورابط التحميل.
- **الحذف:** يتم حذف الملف من التخزين والمستند من Firestore معًا (انظر دالة `deleteContract`).

## سير عمل المطور
- **البناء:**
  - استخدم `flutter pub get` لجلب التبعيات
  - استخدم `flutter run -d chrome` للويب أو `flutter run` للموبايل
- **الاختبار:**
  - اختبارات الواجهة في `test/widget_test.dart` (يمكن التوسيع حسب الحاجة)
- **إعداد Firebase:**
  - حدث `firebase_options.dart` إذا تغير مشروع Firebase
  - تأكد من أن قواعد Firestore/Storage تسمح بالوصول المطلوب للويب
- **إعداد CORS:**
  - لرفع الملفات من الويب، اضبط إعدادات CORS على الباكت باستخدام الأمر: `gsutil cors set cors.json gs://<bucket>`
- **الفوترة:**
  - تأكد من تفعيل الفوترة في Google Cloud لتجنب أخطاء 403

## نقاط التكامل
- **خارجية:**
  - Firebase (مصادقة، قاعدة بيانات، تخزين)
  - خطوط Google Fonts
  - File Picker
- **التواصل بين المكونات:**
  - صفحات الواجهة تتعامل فقط مع الخدمات، والنماذج تستخدم لنقل البيانات

## أمثلة
- **رفع عقد:**
  - تستدعي الواجهة دالة `LegalContractService.uploadContract` مع تمرير بايتات الملف، الاسم، النوع، والوصف
- **حذف عقد:**
  - تستدعي الواجهة دالة `LegalContractService.deleteContract(contract)` ثم تعيد تحميل القائمة

## ملاحظات خاصة
- تحقق دائمًا من صحة قيمة `storageBucket` في `firebase_options.dart`
- مشاكل CORS شائعة في الويب؛ تحقق من إعدادات الباكت إذا فشل الرفع
- جميع رسائل الخطأ الظاهرة للمستخدم باللغة العربية

---

إذا كان هناك أي جزء غير واضح أو ينقصه تفاصيل خاصة بالمشروع، يرجى إرسال ملاحظاتك لتحسين هذه التعليمات.
